#!/bin/bash

mkdir -p "$1" "$2"
build=$(cd "$1/" && pwd)
cache=$(cd "$2/" && pwd)
env_dir="${3}"
buildpack=$(cd "$(dirname $0)/.." && pwd)

indent() {
  sed -u 's/^/       /'
}

cd $cache

# Download SQLite
if [ ! -s sqlite-autoconf-3310100.tar.gz ]; then
  echo "-----> Downloading SQLite"
  curl -so sqlite-autoconf-3310100.tar.gz \
    https://sqlite.org/2020/sqlite-autoconf-3310100.tar.gz \
    | indent
fi

# Unarchive SQLite
if [ ! -s sqlite-autoconf-3310100 ]; then
  echo "-----> Unarchiving SQLite"
  tar -C sqlite-autoconf-3310100 -xf sqlite-autoconf-3310100.tar.gz
fi

# Build SQLite
make
make install --prefix=$build
